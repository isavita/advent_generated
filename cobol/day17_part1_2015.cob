
IDENTIFICATION DIVISION.
PROGRAM-ID. COMBINATION-COUNTER.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO "input.txt"
    ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
01 INPUT-RECORD PIC X(255).

WORKING-STORAGE SECTION.
01 WS-EOF-FLAG           PIC X VALUE 'N'.
   88 EOF-REACHED               VALUE 'Y'.
01 WS-CONTAINER-COUNT    PIC 9(3) VALUE ZEROS.
01 WS-CONTAINERS.
   05 WS-CONTAINER OCCURS 100 TIMES
      INDEXED BY CONTAINER-IDX
      PIC 9(5).

01 WS-TARGET             PIC 9(5) VALUE 150.
01 WS-COMBINATION-COUNT  PIC 9(9) VALUE ZEROS.

01 WS-LINE-IN            PIC X(255).

01 WS-LOOP-IDX           PIC 9(3).
01 WS-BITMASK-LOOP-IDX   PIC 9(10) COMP-5.
01 WS-MAX-BITMASK        PIC 9(10) COMP-5.

01 WS-CURRENT-SUM        PIC 9(9).
01 WS-TEMP-MASK          PIC 9(10) COMP-5.
01 WS-CONTAINER-INDEX    PIC 9(3).

PROCEDURE DIVISION.
MAIN-LOGIC.
    PERFORM READ-INPUT-FILE.
    PERFORM CALCULATE-COMBINATIONS.
    DISPLAY WS-COMBINATION-COUNT.
    STOP RUN.

READ-INPUT-FILE.
    OPEN INPUT INPUT-FILE.
    PERFORM UNTIL EOF-REACHED
        READ INPUT-FILE INTO WS-LINE-IN
            AT END SET EOF-REACHED TO TRUE
            NOT AT END
                ADD 1 TO WS-CONTAINER-COUNT
                MOVE FUNCTION NUMVAL(WS-LINE-IN) TO WS-CONTAINER(WS-CONTAINER-COUNT)
        END-READ
    END-PERFORM.
    CLOSE INPUT-FILE.

CALCULATE-COMBINATIONS.
    MOVE 1 TO WS-MAX-BITMASK.
    PERFORM VARYING WS-LOOP-IDX FROM 1 BY 1 UNTIL WS-LOOP-IDX > WS-CONTAINER-COUNT
        MULTIPLY 2 BY WS-MAX-BITMASK
    END-PERFORM.
    SUBTRACT 1 FROM WS-MAX-BITMASK.

    PERFORM VARYING WS-BITMASK-LOOP-IDX FROM 1 BY 1
        UNTIL WS-BITMASK-LOOP-IDX > WS-MAX-BITMASK

        MOVE ZEROS TO WS-CURRENT-SUM
        MOVE WS-BITMASK-LOOP-IDX TO WS-TEMP-MASK
        MOVE 1 TO WS-CONTAINER-INDEX

        PERFORM UNTIL WS-TEMP-MASK = 0 OR WS-CONTAINER-INDEX > WS-CONTAINER-COUNT
            IF FUNCTION MOD(WS-TEMP-MASK, 2) = 1 THEN
                ADD WS-CONTAINER(WS-CONTAINER-INDEX) TO WS-CURRENT-SUM
            END-IF
            DIVIDE 2 INTO WS-TEMP-MASK GIVING WS-TEMP-MASK
            ADD 1 TO WS-CONTAINER-INDEX
        END-PERFORM

        IF WS-CURRENT-SUM = WS-TARGET THEN
            ADD 1 TO WS-COMBINATION-COUNT
        END-IF
    END-PERFORM.
