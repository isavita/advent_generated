
IDENTIFICATION DIVISION.
PROGRAM-ID. STRING-DECODER.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO "input.txt"
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
01 INPUT-RECORD PIC X(1024).

WORKING-STORAGE SECTION.
01 WS-EOF-FLAG           PIC X VALUE 'N'.
   88 WS-EOF                     VALUE 'Y'.

01 WS-TOTAL-CODE         PIC 9(10) VALUE ZEROS.
01 WS-TOTAL-MEMORY       PIC 9(10) VALUE ZEROS.
01 WS-RESULT             PIC S9(10) VALUE ZEROS.

01 WS-LINE-BUFFER        PIC X(1024).
01 WS-LINE-LENGTH        PIC 9(04).
01 WS-MEMORY-LENGTH      PIC 9(04).
01 WS-CURRENT-POS        PIC 9(04).
01 WS-CHAR               PIC X(01).
01 WS-NEXT-CHAR          PIC X(01).

PROCEDURE DIVISION.
MAIN-LOGIC.
    OPEN INPUT INPUT-FILE

    PERFORM UNTIL WS-EOF
        READ INPUT-FILE INTO WS-LINE-BUFFER
            AT END
                SET WS-EOF TO TRUE
            NOT AT END
                PERFORM PROCESS-LINE
        END-READ
    END-PERFORM

    CLOSE INPUT-FILE

    COMPUTE WS-RESULT = WS-TOTAL-CODE - WS-TOTAL-MEMORY
    DISPLAY WS-RESULT

    STOP RUN.

PROCESS-LINE.
    MOVE FUNCTION LENGTH(FUNCTION TRIM(WS-LINE-BUFFER)) TO WS-LINE-LENGTH.
    ADD WS-LINE-LENGTH TO WS-TOTAL-CODE.

    MOVE 0 TO WS-MEMORY-LENGTH.
    MOVE 2 TO WS-CURRENT-POS.

    PERFORM UNTIL WS-CURRENT-POS > WS-LINE-LENGTH - 1
        MOVE WS-LINE-BUFFER(WS-CURRENT-POS:1) TO WS-CHAR

        IF WS-CHAR = '\' THEN
            IF WS-CURRENT-POS + 1 <= WS-LINE-LENGTH - 1 THEN
                MOVE WS-LINE-BUFFER(WS-CURRENT-POS + 1:1) TO WS-NEXT-CHAR
                IF WS-NEXT-CHAR = '\' OR WS-NEXT-CHAR = '"' THEN
                    ADD 1 TO WS-MEMORY-LENGTH
                    ADD 2 TO WS-CURRENT-POS
                ELSE IF WS-NEXT-CHAR = 'x' THEN
                    IF WS-CURRENT-POS + 3 <= WS-LINE-LENGTH - 1 THEN
                        ADD 1 TO WS-MEMORY-LENGTH
                        ADD 4 TO WS-CURRENT-POS
                    ELSE
                        ADD 1 TO WS-MEMORY-LENGTH
                        ADD 1 TO WS-CURRENT-POS
                    END-IF
                ELSE
                    ADD 1 TO WS-MEMORY-LENGTH
                    ADD 1 TO WS-CURRENT-POS
                END-IF
            ELSE
                ADD 1 TO WS-MEMORY-LENGTH
                ADD 1 TO WS-CURRENT-POS
            END-IF
        ELSE
            ADD 1 TO WS-MEMORY-LENGTH
            ADD 1 TO WS-CURRENT-POS
        END-IF
    END-PERFORM.
    ADD WS-MEMORY-LENGTH TO WS-TOTAL-MEMORY.
