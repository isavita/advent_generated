
IDENTIFICATION DIVISION.
PROGRAM-ID. GENERATOR-MATCH.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO "input.txt"
    ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
01 INPUT-LINE PIC X(20).

WORKING-STORAGE SECTION.
01 WS-GEN-A-START PIC 9(10).
01 WS-GEN-B-START PIC 9(10).

01 WS-GEN-A       PIC S9(10) COMP-5.
01 WS-GEN-B       PIC S9(10) COMP-5.

01 WS-GEN-A-FACTOR PIC S9(5) VALUE 16807 COMP-5.
01 WS-GEN-B-FACTOR PIC S9(5) VALUE 48271 COMP-5.
01 WS-MODULUS      PIC S9(10) VALUE 2147483647 COMP-5.

01 WS-MATCHES      PIC S9(10) VALUE 0 COMP-5.

01 WS-LOOP-COUNTER PIC S9(10) COMP-5.
01 WS-MAX-ITERATIONS PIC S9(10) VALUE 40000000 COMP-5.

01 WS-MASK-VALUE   PIC S9(5) VALUE 65536 COMP-5.

PROCEDURE DIVISION.
MAIN-LOGIC.
    OPEN INPUT INPUT-FILE.
    READ INPUT-FILE INTO WS-GEN-A-START.
    READ INPUT-FILE INTO WS-GEN-B-START.
    CLOSE INPUT-FILE.

    MOVE WS-GEN-A-START TO WS-GEN-A.
    MOVE WS-GEN-B-START TO WS-GEN-B.

    PERFORM VARYING WS-LOOP-COUNTER FROM 1 BY 1
        UNTIL WS-LOOP-COUNTER > WS-MAX-ITERATIONS
        COMPUTE WS-GEN-A = FUNCTION MOD(WS-GEN-A * WS-GEN-A-FACTOR, WS-MODULUS)
        COMPUTE WS-GEN-B = FUNCTION MOD(WS-GEN-B * WS-GEN-B-FACTOR, WS-MODULUS)

        IF FUNCTION MOD(WS-GEN-A, WS-MASK-VALUE) = FUNCTION MOD(WS-GEN-B, WS-MASK-VALUE)
            ADD 1 TO WS-MATCHES
        END-IF
    END-PERFORM.

    DISPLAY WS-MATCHES.
    STOP RUN.
