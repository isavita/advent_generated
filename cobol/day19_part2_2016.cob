
IDENTIFICATION DIVISION.
PROGRAM-ID. ADVENT-OF-CODE-2016-DAY19.
AUTHOR. Your Name.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO 'input.txt'
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
01 INPUT-RECORD          PIC X(10).

WORKING-STORAGE SECTION.
01 WS-EOF-FLAG           PIC X           VALUE 'N'.
   88 WS-EOF                             VALUE 'Y'.

01 WS-NUM-ELVES          PIC 9(7) COMP-5.
01 WS-PART1-RESULT       PIC 9(7) COMP-5.
01 WS-PART2-RESULT       PIC 9(7) COMP-5.

01 WS-POWER-OF-2         PIC 9(7) COMP-5.
01 WS-POWER-OF-3         PIC 9(7) COMP-5.
01 WS-REMAINDER          PIC 9(7) COMP-5.

PROCEDURE DIVISION.
MAIN-LOGIC.
    PERFORM INITIALIZE-PROGRAM.
    PERFORM PROCESS-INPUT.
    PERFORM TERMINATE-PROGRAM.
    STOP RUN.

INITIALIZE-PROGRAM.
    OPEN INPUT INPUT-FILE.
    READ INPUT-FILE INTO INPUT-RECORD
        AT END SET WS-EOF TO TRUE
    END-READ.

    IF NOT WS-EOF THEN
        MOVE FUNCTION NUMVAL(INPUT-RECORD) TO WS-NUM-ELVES
    ELSE
        DISPLAY "Error: input.txt is empty or could not be read."
        STOP RUN
    END-IF.

PROCESS-INPUT.
    PERFORM CALCULATE-PART1.
    PERFORM CALCULATE-PART2.

CALCULATE-PART1.
    MOVE 1 TO WS-POWER-OF-2.
    PERFORM UNTIL WS-POWER-OF-2 * 2 > WS-NUM-ELVES
        COMPUTE WS-POWER-OF-2 = WS-POWER-OF-2 * 2
    END-PERFORM.

    COMPUTE WS-REMAINDER = WS-NUM-ELVES - WS-POWER-OF-2.
    COMPUTE WS-PART1-RESULT = (2 * WS-REMAINDER) + 1.

CALCULATE-PART2.
    MOVE 1 TO WS-POWER-OF-3.
    PERFORM UNTIL WS-POWER-OF-3 * 3 > WS-NUM-ELVES
        COMPUTE WS-POWER-OF-3 = WS-POWER-OF-3 * 3
    END-PERFORM.

    IF WS-NUM-ELVES = WS-POWER-OF-3 THEN
        MOVE WS-NUM-ELVES TO WS-PART2-RESULT
    ELSE
        COMPUTE WS-REMAINDER = WS-NUM-ELVES - WS-POWER-OF-3
        IF WS-REMAINDER <= WS-POWER-OF-3 THEN
            MOVE WS-REMAINDER TO WS-PART2-RESULT
        ELSE
            COMPUTE WS-PART2-RESULT = (2 * WS-REMAINDER) - WS-POWER-OF-3
        END-IF
    END-IF.

TERMINATE-PROGRAM.
    DISPLAY "Part 1: " WS-PART1-RESULT.
    DISPLAY "Part 2: " WS-PART2-RESULT.
    CLOSE INPUT-FILE.

