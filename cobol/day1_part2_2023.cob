
IDENTIFICATION DIVISION.
PROGRAM-ID. CALIBRATION-SUM.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT INPUT-FILE ASSIGN TO "input.txt"
        ORGANIZATION IS LINE SEQUENTIAL
        STATUS IS WS-INPUT-FILE-STATUS.

DATA DIVISION.
FILE SECTION.
FD INPUT-FILE.
01 INPUT-RECORD PIC X(256).

WORKING-STORAGE SECTION.
01 WS-INPUT-FILE-STATUS PIC X(02) VALUE "00".
   88 WS-EOF VALUE "10".

01 WS-TOTAL-SUM PIC 9(10) VALUE ZEROS.

01 WS-FIRST-DIGIT PIC 9.
01 WS-LAST-DIGIT PIC 9.
01 WS-LINE-LENGTH PIC 9(03).
01 WS-CHAR-IDX PIC 9(03).
01 WS-CURRENT-CHAR PIC X.

01 WS-DIGIT-TABLE-DATA.
   05 FILLER.
      10 WS-DIGIT-VALUE-0 PIC 9 VALUE 0.
      10 WS-DIGIT-SPELLING-0 PIC X(05) VALUE "zero".
      10 WS-DIGIT-SPELLING-LEN-0 PIC 9 VALUE 4.
   05 FILLER.
      10 WS-DIGIT-VALUE-1 PIC 9 VALUE 1.
      10 WS-DIGIT-SPELLING-1 PIC X(05) VALUE "one".
      10 WS-DIGIT-SPELLING-LEN-1 PIC 9 VALUE 3.
   05 FILLER.
      10 WS-DIGIT-VALUE-2 PIC 9 VALUE 2.
      10 WS-DIGIT-SPELLING-2 PIC X(05) VALUE "two".
      10 WS-DIGIT-SPELLING-LEN-2 PIC 9 VALUE 3.
   05 FILLER.
      10 WS-DIGIT-VALUE-3 PIC 9 VALUE 3.
      10 WS-DIGIT-SPELLING-3 PIC X(05) VALUE "three".
      10 WS-DIGIT-SPELLING-LEN-3 PIC 9 VALUE 5.
   05 FILLER.
      10 WS-DIGIT-VALUE-4 PIC 9 VALUE 4.
      10 WS-DIGIT-SPELLING-4 PIC X(05) VALUE "four".
      10 WS-DIGIT-SPELLING-LEN-4 PIC 9 VALUE 4.
   05 FILLER.
      10 WS-DIGIT-VALUE-5 PIC 9 VALUE 5.
      10 WS-DIGIT-SPELLING-5 PIC X(05) VALUE "five".
      10 WS-DIGIT-SPELLING-LEN-5 PIC 9 VALUE 4.
   05 FILLER.
      10 WS-DIGIT-VALUE-6 PIC 9 VALUE 6.
      10 WS-DIGIT-SPELLING-6 PIC X(05) VALUE "six".
      10 WS-DIGIT-SPELLING-LEN-6 PIC 9 VALUE 3.
   05 FILLER.
      10 WS-DIGIT-VALUE-7 PIC 9 VALUE 7.
      10 WS-DIGIT-SPELLING-7 PIC X(05) VALUE "seven".
      10 WS-DIGIT-SPELLING-LEN-7 PIC 9 VALUE 5.
   05 FILLER.
      10 WS-DIGIT-VALUE-8 PIC 9 VALUE 8.
      10 WS-DIGIT-SPELLING-8 PIC X(05) VALUE "eight".
      10 WS-DIGIT-SPELLING-LEN-8 PIC 9 VALUE 5.
   05 FILLER.
      10 WS-DIGIT-VALUE-9 PIC 9 VALUE 9.
      10 WS-DIGIT-SPELLING-9 PIC X(05) VALUE "nine".
      10 WS-DIGIT-SPELLING-LEN-9 PIC 9 VALUE 4.

01 WS-DIGIT-TABLE REDEFINES WS-DIGIT-TABLE-DATA.
   05 WS-DIGIT-ENTRY OCCURS 10 TIMES INDEXED BY WS-DIGIT-PTR.
      10 WS-DIGIT-VALUE PIC 9.
      10 WS-DIGIT-SPELLING PIC X(05).
      10 WS-DIGIT-SPELLING-LEN PIC 9.

PROCEDURE DIVISION.
MAIN-LOGIC SECTION.
    OPEN INPUT INPUT-FILE.
    PERFORM 1000-READ-INPUT-FILE.
    PERFORM 2000-PROCESS-LINE UNTIL WS-EOF.
    CLOSE INPUT-FILE.
    DISPLAY WS-TOTAL-SUM.
    STOP RUN.

1000-READ-INPUT-FILE.
    READ INPUT-FILE INTO INPUT-RECORD
    AT END SET WS-EOF TO TRUE
    END-READ.

2000-PROCESS-LINE.
    MOVE ZEROS TO WS-FIRST-DIGIT WS-LAST-DIGIT.
    COMPUTE WS-LINE-LENGTH = FUNCTION LENGTH(FUNCTION TRIM(INPUT-RECORD)).

    PERFORM VARYING WS-CHAR-IDX FROM 1 BY 1
        UNTIL WS-CHAR-IDX > WS-LINE-LENGTH OR WS-FIRST-DIGIT NOT = ZEROS
        MOVE INPUT-RECORD (WS-CHAR-IDX:1) TO WS-CURRENT-CHAR
        IF WS-CURRENT-CHAR NUMERIC
            COMPUTE WS-FIRST-DIGIT = FUNCTION NUMVAL(WS-CURRENT-CHAR)
        ELSE
            PERFORM VARYING WS-DIGIT-PTR FROM 1 BY 1
                UNTIL WS-DIGIT-PTR > 10 OR WS-FIRST-DIGIT NOT = ZEROS
                IF WS-CHAR-IDX + WS-DIGIT-SPELLING-LEN(WS-DIGIT-PTR) - 1 <= WS-LINE-LENGTH
                   AND INPUT-RECORD (WS-CHAR-IDX:WS-DIGIT-SPELLING-LEN(WS-DIGIT-PTR)) = WS-DIGIT-SPELLING(WS-DIGIT-PTR)
                    MOVE WS-DIGIT-VALUE(WS-DIGIT-PTR) TO WS-FIRST-DIGIT
                END-IF
            END-PERFORM
        END-IF
    END-PERFORM.

    PERFORM VARYING WS-CHAR-IDX FROM WS-LINE-LENGTH BY -1
        UNTIL WS-CHAR-IDX < 1 OR WS-LAST-DIGIT NOT = ZEROS
        MOVE INPUT-RECORD (WS-CHAR-IDX:1) TO WS-CURRENT-CHAR
        IF WS-CURRENT-CHAR NUMERIC
            COMPUTE WS-LAST-DIGIT = FUNCTION NUMVAL(WS-CURRENT-CHAR)
        ELSE
            PERFORM VARYING WS-DIGIT-PTR FROM 1 BY 1
                UNTIL WS-DIGIT-PTR > 10 OR WS-LAST-DIGIT NOT = ZEROS
                IF WS-CHAR-IDX + WS-DIGIT-SPELLING-LEN(WS-DIGIT-PTR) - 1 <= WS-LINE-LENGTH
                   AND INPUT-RECORD (WS-CHAR-IDX:WS-DIGIT-SPELLING-LEN(WS-DIGIT-PTR)) = WS-DIGIT-SPELLING(WS-DIGIT-PTR)
                    MOVE WS-DIGIT-VALUE(WS-DIGIT-PTR) TO WS-LAST-DIGIT
                END-IF
            END-PERFORM
        END-IF
    END-PERFORM.

    COMPUTE WS-TOTAL-SUM = WS-TOTAL-SUM + (WS-FIRST-DIGIT * 10) + WS-LAST-DIGIT.
    PERFORM 1000-READ-INPUT-FILE.
