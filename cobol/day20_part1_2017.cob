
       IDENTIFICATION DIVISION.
       PROGRAM-ID. PARTICLE-SORTER.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT INPUT-FILE ASSIGN TO 'input.txt'
               ORGANIZATION IS SEQUENTIAL
               ACCESS IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  INPUT-FILE.
       01  INPUT-RECORD.
           05  RECORD-DATA         PIC X(100).

       WORKING-STORAGE SECTION.
       01  PARTICLE-DATA.
           05  PARTICLES OCCURS 100 TIMES.
               10  P-COORDS OCCURS 3 TIMES PIC S9(5).
               10  V-COORDS OCCURS 3 TIMES PIC S9(5).
               10  A-COORDS OCCURS 3 TIMES PIC S9(5).

       01  WS-COUNTERS.
           05  PARTICLE-COUNT      PIC 9(3) VALUE 0.
           05  CURRENT-PARTICLE-INDEX PIC 9(3).
           05  I                   PIC 9(3).
           05  J                   PIC 9(1).

       01  WS-CALCULATED-VALUES.
           05  ACCEL-SUM           PIC S9(7).
           05  VELOCITY-SUM        PIC S9(7).
           05  POSITION-SUM        PIC S9(7).

       01  WS-MIN-VALUES.
           05  MIN-ACCEL           PIC S9(7) VALUE 9999999.
           05  MIN-VELOCITY        PIC S9(7) VALUE 9999999.
           05  MIN-POSITION        PIC S9(7) VALUE 9999999.
           05  CLOSEST-PARTICLE-INDEX PIC 9(3) VALUE 0.

       01  WS-TEMP-VARS.
           05  TEMP-STRING         PIC X(10).
           05  TEMP-NUM            PIC S9(5).
           05  COORD-STR           PIC X(5).

       PROCEDURE DIVISION.
       MAIN-PROCEDURE.
           OPEN INPUT INPUT-FILE.
           PERFORM READ-AND-PROCESS-PARTICLES.
           CLOSE INPUT-FILE.
           DISPLAY CLOSEST-PARTICLE-INDEX.
           STOP RUN.

       READ-AND-PROCESS-PARTICLES.
           PERFORM UNTIL EOF
               READ INPUT-FILE
                   AT END MOVE 1 TO EOF
               IF NOT EOF
                   ADD 1 TO PARTICLE-COUNT
                   PERFORM PARSE-PARTICLE-LINE
               END-IF
           END-PERFORM.

       PARSE-PARTICLE-LINE.
           MOVE 0 TO J.
           INSPECT RECORD-DATA REPLACING ALL ', ' BY SPACE.
           INSPECT RECORD-DATA REPLACING ALL 'p=' BY SPACE.
           INSPECT RECORD-DATA REPLACING ALL 'v=' BY SPACE.
           INSPECT RECORD-DATA REPLACING ALL 'a=' BY SPACE.
           INSPECT RECORD-DATA REPLACING ALL '(' BY SPACE.
           INSPECT RECORD-DATA REPLACING ALL ')' BY SPACE.

           STRING RECORD-DATA DELIMITED BY SPACE INTO
               TEMP-STRING TEMP-STRING TEMP-STRING
               TEMP-STRING TEMP-STRING TEMP-STRING
               TEMP-STRING TEMP-STRING TEMP-STRING
               END-STRING.

           MOVE 1 TO CURRENT-PARTICLE-INDEX.
           ADD 1 TO PARTICLE-COUNT.

           PERFORM VARYING J FROM 1 BY 1 UNTIL J > 3
               MOVE TEMP-STRING(J:1) TO COORD-STR
               MOVE COORD-STR TO P-COORDS(J)
           END-PERFORM.

           PERFORM VARYING J FROM 1 BY 1 UNTIL J > 3
               MOVE TEMP-STRING(J+3:1) TO COORD-STR
               MOVE COORD-STR TO V-COORDS(J)
           END-PERFORM.

           PERFORM VARYING J FROM 1 BY 1 UNTIL J > 3
               MOVE TEMP-STRING(J+6:1) TO COORD-STR
               MOVE COORD-STR TO A-COORDS(J)
           END-PERFORM.

           PERFORM CALCULATE-PARTICLE-VALUES.
           PERFORM COMPARE-PARTICLE-VALUES.

       CALCULATE-PARTICLE-VALUES.
           MOVE 0 TO ACCEL-SUM, VELOCITY-SUM, POSITION-SUM.
           PERFORM VARYING J FROM 1 BY 1 UNTIL J > 3
               ADD FUNCTION ABS(A-COORDS(J)) TO ACCEL-SUM
               ADD FUNCTION ABS(V-COORDS(J)) TO VELOCITY-SUM
               ADD FUNCTION ABS(P-COORDS(J)) TO POSITION-SUM
           END-PERFORM.

       COMPARE-PARTICLE-VALUES.
           IF ACCEL-SUM < MIN-ACCEL
               MOVE ACCEL-SUM TO MIN-ACCEL
               MOVE VELOCITY-SUM TO MIN-VELOCITY
               MOVE POSITION-SUM TO MIN-POSITION
               MOVE PARTICLE-COUNT TO CLOSEST-PARTICLE-INDEX
           ELSE IF ACCEL-SUM = MIN-ACCEL AND VELOCITY-SUM < MIN-VELOCITY
               MOVE VELOCITY-SUM TO MIN-VELOCITY
               MOVE POSITION-SUM TO MIN-POSITION
               MOVE PARTICLE-COUNT TO CLOSEST-PARTICLE-INDEX
           ELSE IF ACCEL-SUM = MIN-ACCEL AND VELOCITY-SUM = MIN-VELOCITY AND POSITION-SUM < MIN-POSITION
               MOVE POSITION-SUM TO MIN-POSITION
               MOVE PARTICLE-COUNT TO CLOSEST-PARTICLE-INDEX
           END-IF.

       EOF PIC 1 VALUE 0.
